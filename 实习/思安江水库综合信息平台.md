# 1. 业务需求
## 1.1. 平台定位与总体目标

该系统称为“思安江水库综合信息平台”，基于 RuoYi 快速开发框架，定位于**水库（大坝）全生命周期管理**。其主要目标是为水库管理单位提供：

- **实时监测与数据采集**：自动化采集水位、雨量、流量等环境数据，并支持多时段（即时、日/月/年、旬/历史）查询与可视化；
- **预警与阈值管理**：对水位、雨量、流量等关键指标进行阈值配置，自动生成报警记录并向运维人员推送；
- **设备与档案管理**：维护测量设备台账、工程档案（图纸、报告）、维护与巡检记录，确保信息可追溯；
- **运维与应急**：支持日常维护计划与隐患上报、巡检计划与记录，以及应急预案和洪水防汛操作方案管理；
- **业务流程与审批**：提供“业务办公数据库结构”之类的业务办公流程，从发起、一级审批、二级审批到结束，满足内部协同需求；
- **绩效考核**：基于“千分制”模型，对巡检、维护等任务进行量化打分与统计；
- **移动端支撑**：通过 `/app` 系列接口，为手机端推送任务列表、报警、设备数据曲线、考核列表等；
- **系统管理与扩展**：依托 RuoYi 的用户/角色/菜单/权限体系，开放 SMS、微信支付、代码生成、简单流程引擎等公共能力。

## 1.2. 核心业务功能

### 1. 数据采集与监测

- **多源数据**：雨量（小时/日/旬/月/历史）、水位、流量等；
- **可视化曲线**：按日、月、年维度绘制数据趋势图；
### 2. 报警与阈值

- **阈值配置**：管理员可配置各类指标上下限；
- **自动报警**：生成水位报警、雨量报警、流量报警记录；
- **报警记录查询与导出**；

### 3. 设备与档案

- **设备台账**：类型、分类、指标、型号等；
- **档案管理**：大坝档案（DamArchive）、工程图纸（DamEngineeringDrawing）、报告（DamReport）；
- **文件导出**：支持 Excel 导入/导出以便离线归档；

### 4. 维护、巡检与应急

- **维护计划**：年度计划、到期提醒；
- **隐患上报**：维护问题（MaintenanceIssue）登记与跟踪；
- **巡检流程**：巡检计划与巡检记录（PatrolPlan/PatrolRecords）；
- **应急预案与防汛方案**：EmergencyResponsePlan、FloodControlOperationPlan；

### 5. 业务办公流程

- **“业务办公数据库结构”流程**：多级审批（发起 → 一级审批 → 二级审批 → 结束），包括强制驳回、备注、状态流转；
- **审批角色管理**：可配置首/二级审批人，并通过 Web/API 进行审批操作；

### 6. 绩效考核

- **千分制模型**：ThousandthCategory、ThousandthProject、ThousandthIndicator、ThousandthScoreRecord 等；
- **考核列表与详情**：提供分页查询及明细展示；

### 7. 移动端支持

- **统一 App 接口**：`/app` 前缀下一站式获取任务列表、报警、设备数据、考核信息等；
- **消息推送**：SysAppMessage 服务支持移动端消息通知；

## 1.3. 支撑与公共能力

- **系统管理**：基于 RuoYi 的用户/角色/菜单/字典/部门/区域管理，保障权限与组织架构管理；
- **短信与支付**：SMS 配置、模版与发送记录；
- **代码生成**：`hslt-generator` 模块提供表结构到前后端代码的自动化生成；
- **简单流程引擎**：`hslt-flow` 模块（SimpleFlowDefine、Task、Work）支持自定义轻量级业务流；
- **公共库**：`hslt-common` 模块封装分页、注解、工具类（Token、Date、Excel 等）与统一异常处理；

# 2. 项目模块

项目是一个基于 Maven 的多模块工程，共包含以下子模块：hslt-admin、hslt-framework、hslt-system、hslt-quartz、hslt-generator、hslt-common、hslt-care、hslt-flow、hslt-dam、hslt-sync 和 hslt-sms 。下面针对每个模块简要说明其职责：

- **hslt-admin**：  
    提供系统的 Web 后台管理入口，是一个 Spring Boot 应用。包含核心启动类 `ReservoirManageApplication` 和部署支持类 `ReservoirManageInitializer`，以及面向前端的各类 REST 控制器（如业务数据查询、用户登录、APP 接口等） 。
    
- **hslt-framework**：  
    核心框架层，定义公共的控制器基类、统一返回结果（`AjaxResult`、`TableDataInfo`）、分页与树形结构支持、全局异常处理、Swagger 配置等基础设施，为上层模块（如 admin、system）提供底层支撑 。
    
- **hslt-system**：  
    系统功能模块，承载用户管理、部门/岗位管理、菜单与权限分配、字典维护、参数配置、通知公告、日志审计、在线用户监控、服务与缓存监控等系统级功能。通常以 `com.hslt.system` 包名组织业务代码，提供完整的 CRUD 接口与后台管理支撑 。
    
- **hslt-quartz**：  
    定时任务模块，封装 Quartz 调度框架，包含调度配置类 `ScheduleConfig`、作业执行工具类（如 `CronUtils`、`ScheduleUtils`）、并提供 `SysJobController`、`SysJobLogController` 等管理接口，用于动态增删改查定时任务及其执行日志 。
    
- **hslt-generator**：  
    代码生成器模块，通过数据库表结构动态生成 Java 实体、Mapper、Service、Controller 以及前端页面（Vue、API 调用），底层基于 Velocity 模板实现，极大提升 CRUD 开发效率 。
    
- **hslt-common**：  
    通用工具模块，提供全局常量、注解（如 `@DataScope`、`@RepeatSubmit`）、自定义异常（`BaseException`、`UtilException`、文件/用户异常等）、XSS 校验、可重读请求过滤器、Redis 缓存实现、ID 生成工具、Excel 导入导出、微信支付支持、通用 JSON 处理等基础组件 。
    
- **hslt-flow**：  
    简易流程管理模块，支持流程定义与执行，包含 `SimpleFlowController`、`SimpleFlowDefineController`、`SimpleFlowTaskController`、`SimpleFlowWorkController` 等，用于构建轻量级工作流或审批流 。
    
- **hslt-dam**：  
    大坝监测数据模块，负责大坝安全监测相关数据的存储与查询，包括雨量、流量、水位等实时与历史数据实体（如 `DataRainfallCollection`、`DataFlowRateCollection`、`DataWaterLevelCollection`）、设备与告警记录、应急预案等领域模型及对应的 DAO/Service 层 。
    
- **hslt-sync**：  
    数据同步模块，提供多源数据采集（如 GNSS、实体机数据、CF3、第三方监测平台等）的定时拉取与入库功能，通过一系列 `DataCollector` 实现自动同步外部监测数据 。
    
- **hslt-sms**：  
    短信服务模块，封装阿里云与腾讯云 SMS 接口，提供 `SmsService` 接口及模板 `AliyunSmsTemplate`、`TencentSmsTemplate` 实现，用于系统内验证码、告警与通知短信发送 。

# 3. 雨量统计Controller需求分析

### 1. `DataRainfallCollectionController`

**路径**：`/dam/rainFallCollection`  
**功能定位**：实时雨量数据采集管理

- **列表查询**：分页获取各雨量传感器的实时采集记录，用于运维监控和前端实时展示
- **导出**：把列表数据导出为 Excel，方便离线分析和存档
- **详情/增删改**：支持根据 ID 查询单条详情，并提供新增、更新接口，以补录或修正实时数据

此 Controller 满足“对原始采集数据进行全生命周期管理”的业务需求，包括实时监测、数据校正和报表导出。

### 2. `DataRainfallCollectionHourHistoricalController`

**路径**：`/dam/hourHistorical`  
**功能定位**：小时级历史数据查询与统计

- **分页列表**：按条件（设备、时间范围等）分页获取历史小时粒度数据，支持前端翻页展示
- **VO 列表**：提供 `DataRainfallCollectionHourHistoricalVo` 视图层对象列表，简化前端展示字段
- **特征值查询**：返回小时维度的统计结果（最大值、最小值、总和等），用于快速生成小时报表
- **按粒度取点**：根据页面传入的粒度（如 15min／30min）返回多设备采集值集合，支撑前端折线图等可视化

满足“深度分析小时粒度历史数据、灵活生成图表”的需求。

### 3. `DataRainfallCollectionDayHistoricalController`

**路径**：`/dam/dayRainHistorical`  
**功能定位**：日降雨量历史数据管理

- **当日＋历史列表**：通过 `selectDataRainAndTodyList` 同时获取今天和历日日降雨统计，方便对比
- **导出**：历史日数据导出为 Excel，用于月度／季度报表汇总
- **详情／报告列表**：支持按 ID 查询详细记录，及返回 `RainReport` 报表数据列表

满足“日粒度雨量汇总统计、当日对比、历史报表”一体化的数据查询与导出需求。

### 4. `DataRainfallCollectionTenDaysHistoricalController`

**路径**：`/dam/tenRainHistorical`  
**功能定位**：旬（10 天）降雨量数据管理

- **列表／导出**：CRUD 接口，支持分页查询和 Excel 导出旬数据
- **增删改**：手动补录和维护旬统计数据
- **旬报表查询**：`/alllist` 返回 `RainReport` 对象列表，用于生成上旬/中旬/下旬分段统计报告

满足“对每月 1–10 日、11–20 日、21–月底的分段降雨量统计和维护”需求。

### 5. `DataRainfallCollectionYearHistoricalController`

**路径**：`/dam/yearRainHistorical`  
**功能定位**：年降雨量历史数据管理

- **列表／导出**：分页查询年度汇总数据并导出
- **详情／增删改**：按年度记录查看、补录、修改、批量删除
- **报表支撑**：为年终汇总、决策分析提供完整年度降雨量数据

满足“年度降雨量汇总统计与运维维护”需求。

### 6. `DataRainfallCollectionHistoricalController`

**路径**：`/dam/rainFallCollectionHistorical`  
**功能定位**：通用历史数据采集与可视化 API

- **列表／导出**：分页查询任意粒度的历史原始采集数据并导出
- **灵活分页**：支持 `PageDomain`／`TableSupport` 按前端需求自定义分页参数
- **按粒度取值**：`/getCollection/{timeGranularity}` 接口可按任意时间粒度（小时、日等）返回多设备采集值列表
- **设备展现**：结合 `DeviceExhibitionVO` 返回多设备对比视图数据

满足“前端灵活选择时间粒度，自由拼装多设备历史曲线图和对比报表”需求。


