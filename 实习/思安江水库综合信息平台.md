# 1. 业务需求
## 1.1. 平台定位与总体目标

该系统称为“思安江水库综合信息平台”，基于 RuoYi 快速开发框架，定位于**水库（大坝）全生命周期管理**。其主要目标是为水库管理单位提供：

- **实时监测与数据采集**：自动化采集水位、雨量、流量等环境数据，并支持多时段（即时、日/月/年、旬/历史）查询与可视化；
- **预警与阈值管理**：对水位、雨量、流量等关键指标进行阈值配置，自动生成报警记录并向运维人员推送；
- **设备与档案管理**：维护测量设备台账、工程档案（图纸、报告）、维护与巡检记录，确保信息可追溯；
- **运维与应急**：支持日常维护计划与隐患上报、巡检计划与记录，以及应急预案和洪水防汛操作方案管理；
- **业务流程与审批**：提供“业务办公数据库结构”之类的业务办公流程，从发起、一级审批、二级审批到结束，满足内部协同需求；
- **绩效考核**：基于“千分制”模型，对巡检、维护等任务进行量化打分与统计；
- **移动端支撑**：通过 `/app` 系列接口，为手机端推送任务列表、报警、设备数据曲线、考核列表等；
- **系统管理与扩展**：依托 RuoYi 的用户/角色/菜单/权限体系，开放 SMS、微信支付、代码生成、简单流程引擎等公共能力。

## 1.2. 核心业务功能

### 1. 数据采集与监测

- **多源数据**：雨量（小时/日/旬/月/历史）、水位、流量等；
- **可视化曲线**：按日、月、年维度绘制数据趋势图；
### 2. 报警与阈值

- **阈值配置**：管理员可配置各类指标上下限；
- **自动报警**：生成水位报警、雨量报警、流量报警记录；
- **报警记录查询与导出**；

### 3. 设备与档案

- **设备台账**：类型、分类、指标、型号等；
- **档案管理**：大坝档案（DamArchive）、工程图纸（DamEngineeringDrawing）、报告（DamReport）；
- **文件导出**：支持 Excel 导入/导出以便离线归档；

### 4. 维护、巡检与应急

- **维护计划**：年度计划、到期提醒；
- **隐患上报**：维护问题（MaintenanceIssue）登记与跟踪；
- **巡检流程**：巡检计划与巡检记录（PatrolPlan/PatrolRecords）；
- **应急预案与防汛方案**：EmergencyResponsePlan、FloodControlOperationPlan；

### 5. 业务办公流程

- **“业务办公数据库结构”流程**：多级审批（发起 → 一级审批 → 二级审批 → 结束），包括强制驳回、备注、状态流转；
- **审批角色管理**：可配置首/二级审批人，并通过 Web/API 进行审批操作；

### 6. 绩效考核

- **千分制模型**：ThousandthCategory、ThousandthProject、ThousandthIndicator、ThousandthScoreRecord 等；
- **考核列表与详情**：提供分页查询及明细展示；

### 7. 移动端支持

- **统一 App 接口**：`/app` 前缀下一站式获取任务列表、报警、设备数据、考核信息等；
- **消息推送**：SysAppMessage 服务支持移动端消息通知；

## 1.3. 支撑与公共能力

- **系统管理**：基于 RuoYi 的用户/角色/菜单/字典/部门/区域管理，保障权限与组织架构管理；
- **短信与支付**：SMS 配置、模版与发送记录；
- **代码生成**：`hslt-generator` 模块提供表结构到前后端代码的自动化生成；
- **简单流程引擎**：`hslt-flow` 模块（SimpleFlowDefine、Task、Work）支持自定义轻量级业务流；
- **公共库**：`hslt-common` 模块封装分页、注解、工具类（Token、Date、Excel 等）与统一异常处理；

# 2. 项目模块

项目是一个基于 Maven 的多模块工程，共包含以下子模块：hslt-admin、hslt-framework、hslt-system、hslt-quartz、hslt-generator、hslt-common、hslt-care、hslt-flow、hslt-dam、hslt-sync 和 hslt-sms 。下面针对每个模块简要说明其职责：

- **hslt-admin**：  
    提供系统的 Web 后台管理入口，是一个 Spring Boot 应用。包含核心启动类 `ReservoirManageApplication` 和部署支持类 `ReservoirManageInitializer`，以及面向前端的各类 REST 控制器（如业务数据查询、用户登录、APP 接口等） 。
    
- **hslt-framework**：  
    核心框架层，定义公共的控制器基类、统一返回结果（`AjaxResult`、`TableDataInfo`）、分页与树形结构支持、全局异常处理、Swagger 配置等基础设施，为上层模块（如 admin、system）提供底层支撑 。
    
- **hslt-system**：  
    系统功能模块，承载用户管理、部门/岗位管理、菜单与权限分配、字典维护、参数配置、通知公告、日志审计、在线用户监控、服务与缓存监控等系统级功能。通常以 `com.hslt.system` 包名组织业务代码，提供完整的 CRUD 接口与后台管理支撑 。
    
- **hslt-quartz**：  
    定时任务模块，封装 Quartz 调度框架，包含调度配置类 `ScheduleConfig`、作业执行工具类（如 `CronUtils`、`ScheduleUtils`）、并提供 `SysJobController`、`SysJobLogController` 等管理接口，用于动态增删改查定时任务及其执行日志 。
    
- **hslt-generator**：  
    代码生成器模块，通过数据库表结构动态生成 Java 实体、Mapper、Service、Controller 以及前端页面（Vue、API 调用），底层基于 Velocity 模板实现，极大提升 CRUD 开发效率 。
    
- **hslt-common**：  
    通用工具模块，提供全局常量、注解（如 `@DataScope`、`@RepeatSubmit`）、自定义异常（`BaseException`、`UtilException`、文件/用户异常等）、XSS 校验、可重读请求过滤器、Redis 缓存实现、ID 生成工具、Excel 导入导出、微信支付支持、通用 JSON 处理等基础组件 。
    
- **hslt-flow**：  
    简易流程管理模块，支持流程定义与执行，包含 `SimpleFlowController`、`SimpleFlowDefineController`、`SimpleFlowTaskController`、`SimpleFlowWorkController` 等，用于构建轻量级工作流或审批流 。
    
- **hslt-dam**：  
    大坝监测数据模块，负责大坝安全监测相关数据的存储与查询，包括雨量、流量、水位等实时与历史数据实体（如 `DataRainfallCollection`、`DataFlowRateCollection`、`DataWaterLevelCollection`）、设备与告警记录、应急预案等领域模型及对应的 DAO/Service 层 。
    
- **hslt-sync**：  
    数据同步模块，提供多源数据采集（如 GNSS、实体机数据、CF3、第三方监测平台等）的定时拉取与入库功能，通过一系列 `DataCollector` 实现自动同步外部监测数据 。
    
- **hslt-sms**：  
    短信服务模块，封装阿里云与腾讯云 SMS 接口，提供 `SmsService` 接口及模板 `AliyunSmsTemplate`、`TencentSmsTemplate` 实现，用于系统内验证码、告警与通知短信发送 。

# 3. 雨量业务

## 3.1. 实时数据采集

- 定时或实时接收、存储各监测点的原始降雨量读数
- 支持多种接入方式（多厂商传感器），并统一记录设备ID、采集时间、采集值及单位
- 提供接口可按时间范围或设备维度查询最新或历史原始数据

## 3.2. 多粒度历史数据管理

- **小时级**、**日级**、**旬级（十天）**、**月级**、**季级**、**年级**多维度历史归档
- 系统按粒度定期汇总原始数据并存入对应的历史表，以便高效查询与统计
- 支持分页查看各粒度下的历史数据，满足灵活检索需求

## 3.3. 统计汇总与报表

- **滑动窗口统计**：自动计算过去 1、4、8、12、24 小时的累计降雨量
- **固定周期汇总**：根据年、季、月、旬等周期，汇总各监测点或全网的降雨总量
- **设备分组比对**：可按传感器分组，对比各组的累计、最大、最小值及发生时间
- **层级报表**：在统一查询界面，支持按年—季—月三级联动展示统计结果
- **动态实时值**：当期周期尚未结束时，自动追加“当前已记录最大/最小值”数据

## 3.4. 阈值告警

- 根据预设上下限阈值，对单点或汇总后的降雨量进行超高/偏低告警
- 支持对告警事件的产生时间、持续时长、处理状态进行记录与查询
- 提供告警列表、告警详情及历史告警统计功能，方便运维人员监控和复盘

## 3.5. 数据导出与报表模板

- 提供一键导出：任意粒度的原始或统计数据均可生成 Excel 报表
- 内置多套模板：日常列表导出模板与年度汇编/专题报表模板
- 导出文件自动填充：包括标题、统计区间、汇总表格及图例占位，交付给运营或管理端

### 整体流程概览

1. **采集** → 2. **分粒度归档** → 3. **滑动与周期统计** → 4. **阈值监测与告警** → 5. **报表导出**

- 全流程闭环，既满足实时监控，也支持历史审计与多维度分析。
- 既能灵活查询单点数据，也能开展全网或分组的综合报表。

# 4. 实时数据采集



