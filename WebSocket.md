WebSocket 是一种网络通信协议，旨在通过单个 TCP 连接实现客户端与服务器之间的全双工通信。该协议于 2011 年被 IETF 标准化为 RFC 6455，后由 RFC 7936 补充规范。WebSocket 使得客户端和服务器之间的数据交换更加高效，允许服务器主动向客户端推送数据，适用于对实时性要求较高的应用场景，如在线聊天、实时游戏、股票行情等 。

# 1. WebSocket 的工作原理

WebSocket 的通信过程主要包括以下几个步骤：[apifox+1perfect.org+1](https://apifox.com/apiskills/websocket-principle-explained/?utm_source=chatgpt.com)

1. **握手阶段**：客户端通过发送带有特殊头部的 HTTP 请求（如 `Upgrade: websocket` 和 `Connection: Upgrade`）来请求升级协议。服务器收到请求后，若支持 WebSocket，会返回状态码 101（Switching Protocols），并确认升级。
2. **建立连接**：握手成功后，客户端和服务器之间建立一个持久的 TCP 连接，双方可以在该连接上进行双向通信。
3. **数据传输**：在连接期间，客户端和服务器可以随时互相发送数据。WebSocket 协议定义了数据帧的格式，支持文本和二进制数据。
4. **关闭连接**：任一方可以随时发送关闭帧来终止连接，另一方收到后也应发送关闭帧作为回应。

# 2. WebSocket 的优势

- **实时双向通信**：服务器可以主动向客户端推送数据，无需客户端轮询，提高了实时性。
- **减少网络开销**：相比传统的 HTTP 请求，WebSocket 的数据帧头部较小，减少了传输的冗余数据。
- **保持连接状态**：一旦建立连接，客户端和服务器之间的通信无需重复建立和关闭连接，降低了延迟。
- **支持二进制数据**：除了文本数据，WebSocket 还支持二进制数据的传输，适用于多种应用场景。

# 3. WebSocket 与 HTTP 的区别
| 特性      | HTTP       | WebSocket       |
| ------- | ---------- | --------------- |
| 通信模式    | 请求-响应（单向）  | 全双工（双向）         |
| 连接方式    | 每次请求建立新连接  | 一次握手后保持连接       |
| 服务器推送能力 | 不支持        | 支持              |
| 数据传输效率  | 较低，头部信息冗余  | 高效，头部信息精简       |
| 应用场景    | 静态网页、表单提交等 | 实时聊天、在线游戏、股票行情等 |